digraph zabbix {
	fontname = "Courier New, SimSun";
	node [shape=Mrecord,fontname="MONACO,Courier New,SimSun"];
	edge [fontname="Courier New,SimSun"];
	
	extscript [fontsize=11, shape="note", label=<
		<table border="0" cellborder="0" cellspacing="0" align="left">
			<tr><td align="left" bgcolor="lightcyan">externalscripts</td></tr>
			<tr><td align="left" port="nginx">reqstat.sh[nginxlist]  ({{#TAG}:tag, {#REQSTAT_IP}:ip}})</td></tr>
			<tr><td align="left" port="applist">reqstat.sh[applist]  ({{#TAG}:tag, {#APP_NAME}:appname})</td></tr>
			<tr><td align="left" port="getstat">reqstat.sh[getstat]  ({"data":[]})</td></tr>

		</table>
	>];
		
	subgraph cluster_lld {
		label="控制器(A Zabbix Host)";
		style="filled";
		bgcolor="mintcream";
		
		zbxhost [shape=record, label="<lld1>LLD1|<lld2>LLD2|<micro>Micro:\n \{$CLUSTER.TYPE\} = \{#TAG\} "];
		list [shape="plaintext", label=<
			<table border="0" cellborder="1" cellspacing="0" align="left">
				<tr><td bgcolor="lightcyan">Tengine列表生成器</td></tr>
				<tr><td port="host">Host Prototype:<br />{#TAG}_{#REQSTAT_IP}</td></tr>
			</table>
		>];
		
		getstat [shape="plaintext", label=<
			<table border="0" cellborder="1" cellspacing="0" align="left">
				<tr><td bgcolor="lightcyan">数据采集器</td></tr>
				<tr><td port="sender">返回空json<br />仅做定时任务</td></tr>
			</table>
		>];
		
		zbxhost:lld1 -> getstat[style="bold"];
		zbxhost:lld2 -> list;
		zbxhost:micro -> list:host:e [style="dashed", taillabel=" 继承"];
	}
	
	extscript:nginx -> zbxhost:lld2 [arrowhead=invodot, label="KEY", style="dashed"];
	extscript:getstat:w -> zbxhost:lld1 [arrowhead=invodot, label="KEY", style="bold"];
	
	template [shape="plaintext", label=<
		<table border="0" cellborder="1" cellspacing="0" align="left">
			<tr><td bgcolor="lightcyan">模板</td></tr>
			<tr><td port="applist">LLD获取APP列表 with Filter:<br />{#TAG} match {$CLUSTER.TYPE}</td></tr>
			<tr><td port="application">application prototypes:<br/>{#APP_NAME}</td></tr>
			<tr><td port="item">item prototypes:<br/>req_total-{#APP_NAME}等</td></tr>
			<tr><td port="graph">graph prototypes</td></tr>
			<tr><td port="trigger">trigger prototypes</td></tr>
		</table>
	>];
	
	extscript:applist -> template:applist [arrowhead=invodot, label="KEY", style="dashed"];
	host [label="TAG_10.0.0.1", color="chartreuse2", style="filled"];

	list:host -> template [label="链接", color="red"];
	list:host -> host[label="生成"];
	
	template -> host [label="链接", style="dashed"];
	
	getstat:sender -> host [taillabel="zabbix_sender", style="bold"];
}